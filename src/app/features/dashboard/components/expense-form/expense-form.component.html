<p-dialog
  [header]="isEdit ? 'Editar Gasto' : 'Novo Gasto'"
  [(visible)]="visible"
  [modal]="true"
  [style]="isMobile ? { width: '100vw', height: '100vh', margin: '0', 'max-height': 'none' } : { width: '100vw', maxWidth: '500px' }"
  [breakpoints]="{ '960px': '75vw', '640px': '100vw' }"
  [draggable]="false"
  [resizable]="false"
  [styleClass]="isMobile ? 'p-dialog-maximized' : ''"
  (onHide)="onClose()"
>
  <div class="flex flex-col gap-4 p-1 sm:p-2">
    <!-- Quick Actions -->
    <div class="flex gap-2 flex-wrap items-center">
      <span class="text-[10px] uppercase font-bold text-surface-400 w-full">Sugestões:</span>
      @for (qt of quickExpenseTypes; track qt) {
        <p-button
          [label]="qt.label"
          [icon]="qt.icon"
          (click)="applyQuickExpense(qt)"
          severity="secondary"
          size="small"
          class="flex-1 sm:flex-none"
        ></p-button>
      }
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col gap-4 mt-2">
      <!-- Description -->
      <div class="flex flex-col gap-1.5">
        <label for="description" class="text-sm font-medium">Descrição</label>
        <input pInputText id="description" formControlName="description" class="w-full !h-10 sm:!h-11" placeholder="Ex: Conta de Luz" />
      </div>

      <!-- Price & Type -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <div class="flex flex-col gap-1.5">
          <label for="price" class="text-sm font-medium">Valor (R$)</label>
          <p-inputnumber
            id="price"
            formControlName="price"
            mode="currency"
            currency="BRL"
            locale="pt-BR"
            styleClass="w-full"
            inputStyleClass="w-full !h-10 sm:!h-11"
          >
          </p-inputnumber>
        </div>
        <div class="flex flex-col gap-1.5">
          <label for="type" class="text-sm font-medium">Tipo</label>
          <p-select
            id="type"
            [options]="expenseTypes"
            formControlName="type"
            optionLabel="label"
            optionValue="value"
            [showClear]="false"
            styleClass="w-full !h-10 sm:!h-11"
            appendTo="body"
          >
            <ng-template pTemplate="selectedItem" let-selectedOption>
              @if (selectedOption) {
                <div class="flex items-center gap-2">
                  <i [class]="selectedOption.icon" class="text-primary"></i>
                  <div class="text-sm">{{ selectedOption.label }}</div>
                </div>
              }
            </ng-template>
            <ng-template let-type pTemplate="item">
              <div class="flex items-center gap-2">
                <i [class]="type.icon" class="text-surface-400"></i>
                <div class="text-sm">{{ type.label }}</div>
              </div>
            </ng-template>
          </p-select>
        </div>
      </div>

      <!-- Date -->
      <div class="flex flex-col gap-1.5">
        <label for="purchaseDate" class="text-sm font-medium">Data do Pagamento</label>
        <p-datepicker
          id="purchaseDate"
          formControlName="purchaseDate"
          dateFormat="dd/mm/yy"
          [showIcon]="true"
          styleClass="w-full"
          inputStyleClass="w-full !h-10 sm:!h-11"
          appendTo="body"
        >
        </p-datepicker>
      </div>

      <!-- Conditional Fields -->
      @if (form.get('type')?.value === 'ELECTRICITY') {
        <div class="flex flex-col gap-1.5 animate-fadein">
          <label for="kws" class="text-sm font-medium">Kilowatts (KWs)</label>
          <p-inputnumber id="kws" formControlName="kws" suffix=" kW" styleClass="w-full" inputStyleClass="w-full !h-10 sm:!h-11"></p-inputnumber>
        </div>
      }
      @if (form.get('type')?.value === 'WATER') {
        <div class="flex flex-col gap-1.5 animate-fadein">
          <label for="cubicMeters" class="text-sm font-medium">Metros Cúbicos (m³)</label>
          <p-inputnumber
            id="cubicMeters"
            formControlName="cubicMeters"
            suffix=" m³"
            styleClass="w-full"
            inputStyleClass="w-full !h-10 sm:!h-11"
          ></p-inputnumber>
        </div>
      }
      @if (form.get('type')?.value === 'CONDOMINIUM') {
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 animate-fadein">
          <div class="flex flex-col gap-1.5">
            <label for="association" class="text-sm font-medium">Associação (R$)</label>
            <p-inputnumber
              id="association"
              formControlName="association"
              mode="currency"
              currency="BRL"
              locale="pt-BR"
              styleClass="w-full"
              inputStyleClass="w-full !h-10 sm:!h-11"
            >
            </p-inputnumber>
          </div>
          <div class="flex flex-col gap-1.5">
            <label for="reserveFund" class="text-sm font-medium">Fundo de Reserva (R$)</label>
            <p-inputnumber
              id="reserveFund"
              formControlName="reserveFund"
              mode="currency"
              currency="BRL"
              locale="pt-BR"
              styleClass="w-full"
              inputStyleClass="w-full !h-10 sm:!h-11"
            >
            </p-inputnumber>
          </div>
        </div>
      }

      <!-- Observation -->
      <div class="flex flex-col gap-1.5">
        <label for="observation" class="text-sm font-medium">Observação</label>
        <textarea
          pTextarea
          id="observation"
          formControlName="observation"
          rows="3"
          class="w-full"
          placeholder="Detalhes adicionais..."
        ></textarea>
      </div>

      <!-- Actions -->
      <div class="flex flex-col sm:flex-row justify-end gap-2 mt-4">
        <p-button label="Cancelar" (click)="onClose()" severity="secondary" variant="outlined" class="w-full sm:w-auto"></p-button>
        <p-button type="submit" label="Salvar Gasto" [disabled]="form.invalid" class="w-full sm:w-auto"></p-button>
      </div>
    </form>
  </div>
</p-dialog>
