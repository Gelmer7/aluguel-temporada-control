<app-dialog
  [(visible)]="visible"
  [header]="(isEdit ? 'EXPENSES_FORM.EDIT' : 'EXPENSES_FORM.NEW') | translate"
  [icon]="isEdit ? 'pi pi-pencil' : 'pi pi-plus'"
  [width]="isMobile ? '92vw' : '600px'"
  [saveLabel]="(isEdit ? 'ACTIONS.SAVE' : 'ACTIONS.SAVE_EXPENSE') | translate"
  [saveDisabled]="form.invalid"
  (onSave)="onSubmit()"
  (onCancel)="onClose()"
>
  <!-- Custom Toolbar in Header -->
  <div header-toolbar class="flex gap-2">
    <p-button
      icon="pi pi-filter-slash"
      (click)="clearForm()"
      [text]="true"
      severity="secondary"
      size="small"
      [pTooltip]="'ACTIONS.CLEAR' | translate"
      tooltipPosition="bottom"
    />
  </div>

  <div content class="flex flex-col gap-2 p-1 sm:p-2">
    <!-- Quick Actions -->
    <div class="flex gap-2 overflow-x-auto no-scrollbar py-1">
      @for (qt of quickExpenseTypes; track qt) {
        <p-button
          [label]="qt.label | translate"
          [icon]="qt.icon"
          (click)="applyQuickExpense(qt)"
          severity="secondary"
          size="small"
          class="flex-none max-w-[110px]"
          styleClass="w-full"
        >
          <ng-template pTemplate="content">
            <div class="flex items-center gap-2 overflow-hidden w-full">
              <span class="truncate">{{ qt.label | translate }}</span>
            </div>
          </ng-template>
        </p-button>
      }
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="flex flex-col gap-4 mt-2">
      <!-- Description -->
      <p-iftalabel class="w-full">
        <input
          pInputText
          id="description"
          formControlName="description"
          class="w-full !h-10 sm:!h-11"
          [placeholder]="'EXPENSES_FORM.PLACEHOLDER_DESCRIPTION' | translate"
        />
        <label for="description">{{ 'EXPENSES_FORM.DESCRIPTION' | translate }}</label>
      </p-iftalabel>

      <!-- Price & Type -->
      <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
        <p-iftalabel class="w-full">
          <p-inputnumber
            id="price"
            formControlName="price"
            mode="currency"
            currency="BRL"
            locale="pt-BR"
            styleClass="w-full"
            inputStyleClass="w-full !h-10 sm:!h-11"
          >
          </p-inputnumber>
          <label for="price">{{ 'EXPENSES_FORM.PRICE' | translate }} (R$)</label>
        </p-iftalabel>

        <p-iftalabel class="w-full">
          <p-select
            id="type"
            [options]="expenseTypes"
            formControlName="type"
            optionLabel="label"
            optionValue="value"
            [showClear]="false"
            styleClass="w-full !h-10 sm:!h-11"
            appendTo="body"
          >
            <ng-template pTemplate="selectedItem" let-selectedOption>
              @if (selectedOption) {
                <div class="flex items-center gap-2">
                  <i [class]="selectedOption.icon" class="text-primary"></i>
                  <div>{{ selectedOption.label | translate }}</div>
                </div>
              }
            </ng-template>
            <ng-template let-type pTemplate="item">
              <div class="flex items-center gap-2">
                <i [class]="type.icon"></i>
                <div>{{ type.label | translate }}</div>
              </div>
            </ng-template>
          </p-select>
          <label for="type">{{ 'EXPENSES_FORM.TYPE' | translate }}</label>
        </p-iftalabel>
      </div>

      <!-- Date -->
      <p-iftalabel class="w-full">
        <p-datepicker
          id="purchaseDate"
          formControlName="purchaseDate"
          [dateFormat]="'PRIMENG.dateFormat' | translate"
          [placeholder]="'PRIMENG.dateFormat' | translate"
          [showIcon]="true"
          styleClass="w-full"
          inputStyleClass="w-full !h-10 sm:!h-11"
          appendTo="body"
        >
        </p-datepicker>
        <label for="purchaseDate">{{ 'EXPENSES_FORM.DATE' | translate }}</label>
      </p-iftalabel>

      <!-- Conditional Fields -->
      @if (form.get('type')?.value === 'ELECTRICITY') {
        <p-iftalabel class="w-full animate-fadein">
          <p-inputnumber
            id="kws"
            formControlName="kws"
            suffix=" kW"
            styleClass="w-full"
            inputStyleClass="w-full !h-10 sm:!h-11"
          ></p-inputnumber>
          <label for="kws">{{ 'EXPENSES_FORM.KWS' | translate }}</label>
        </p-iftalabel>
      }
      @if (form.get('type')?.value === 'WATER') {
        <p-iftalabel class="w-full animate-fadein">
          <p-inputnumber
            id="cubicMeters"
            formControlName="cubicMeters"
            suffix=" mÂ³"
            styleClass="w-full"
            inputStyleClass="w-full !h-10 sm:!h-11"
          ></p-inputnumber>
          <label for="cubicMeters">{{ 'EXPENSES_FORM.CUBIC_METERS' | translate }}</label>
        </p-iftalabel>
      }
      @if (form.get('type')?.value === 'CONDOMINIUM') {
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 animate-fadein">
          <p-iftalabel class="w-full">
            <p-inputnumber
              id="reserveFund"
              formControlName="reserveFund"
              mode="currency"
              currency="BRL"
              locale="pt-BR"
              styleClass="w-full"
              inputStyleClass="w-full !h-10 sm:!h-11"
            >
            </p-inputnumber>
            <label for="reserveFund">{{ 'EXPENSES_FORM.RESERVE_FUND' | translate }} (R$)</label>
          </p-iftalabel>

          <p-iftalabel class="w-full">
            <p-inputnumber
              id="association"
              formControlName="association"
              mode="currency"
              currency="BRL"
              locale="pt-BR"
              styleClass="w-full"
              inputStyleClass="w-full !h-10 sm:!h-11"
            >
            </p-inputnumber>
            <label for="association">{{ 'EXPENSES_FORM.ASSOCIATION' | translate }} (R$)</label>
          </p-iftalabel>
        </div>
      }

      <!-- Observation -->
      <p-iftalabel class="w-full">
        <textarea
          pTextarea
          id="observation"
          formControlName="observation"
          rows="3"
          class="w-full"
          [placeholder]="'EXPENSES_FORM.PLACEHOLDER_OBSERVATION' | translate"
        ></textarea>
        <label for="observation">{{ 'EXPENSES_FORM.OBSERVATION' | translate }}</label>
      </p-iftalabel>
    </form>
  </div>
</app-dialog>
