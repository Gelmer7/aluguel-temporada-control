<ng-template #headerActions>
  <div class="flex items-center gap-2">
    <p-button
      icon="pi pi-plus"
      severity="success"
      [size]="'small'"
      (click)="openNew()"
      [pTooltip]="'SUGGESTIONS_FORM.NEW' | translate"
    />

    <div
      class="flex items-center gap-2 bg-surface-50 dark:bg-surface-800 px-2 py-1 rounded-lg border border-surface-200 dark:border-surface-700 shadow-sm"
    >
      <span class="text-[10px] font-bold text-surface-500 uppercase tracking-wider">{{
        'TERMS.STATUS' | translate
      }}</span>
      <p-select
        [options]="statusOptions"
        [ngModel]="filters().status"
        (ngModelChange)="onFilterChange($event)"
        optionLabel="label"
        optionValue="value"
        [placeholder]="'TERMS.FILTER_BY_STATUS' | translate"
        class="border-none h-8"
        variant="filled"
      >
        <ng-template let-option pTemplate="item">
          <span class="text-xs">{{ option.label | translate }}</span>
        </ng-template>
        <ng-template let-option pTemplate="selectedItem">
          <span class="text-xs">{{ option.label | translate }}</span>
        </ng-template>
      </p-select>
    </div>
  </div>
</ng-template>

<div class="h-full flex flex-col p-2 bg-surface-50 dark:bg-surface-950 gap-2 overflow-hidden">
  <p-toast />
  <p-confirm-dialog />

  @if (loading()) {
    <div class="flex justify-center p-12">
      <i class="pi pi-spin pi-spinner text-4xl text-primary"></i>
    </div>
  } @else {
    @if (suggestions().length === 0) {
      <div
        class="text-center p-16 bg-white dark:bg-surface-900 rounded-xl border border-dashed border-surface-300 dark:border-surface-700"
      >
        <div class="flex flex-col items-center gap-4">
          <i class="pi pi-inbox text-6xl opacity-20"></i>
          <span class="text-xl font-medium opacity-60">{{
            'SUGGESTIONS_FORM.NO_DATA' | translate
          }}</span>
          <p-button
            [label]="'SUGGESTIONS_FORM.CREATE_FIRST' | translate"
            icon="pi pi-plus"
            (click)="openNew()"
            [text]="true"
          />
        </div>
      </div>
    } @else {
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 overflow-y-auto">
        @for (suggestion of suggestions(); track suggestion.id) {
          <div
            class="dark:bg-surface-900 rounded-2xl border border-surface-200 dark:border-surface-700 shadow-sm hover:shadow-xl transition-all duration-300 flex flex-col h-full overflow-hidden group"
          >
            <!-- Card Header -->
            <div
              class="p-2 border-b border-surface-100 dark:border-surface-800 flex justify-between items-start gap-4"
            >
              <h2
                class="text-xl font-bold m-0 leading-snug text-surface-900 dark:text-surface-0 flex-1 line-clamp-2"
              >
                {{ suggestion.title }}
              </h2>
              <p-tag
                [value]="'SUGGESTIONS_FORM.STATUS.' + suggestion.status | translate"
                [severity]="getStatusSeverity(suggestion.status)"
                [rounded]="true"
                class="flex-shrink-0 shadow-sm"
              />
            </div>

            <!-- Card Content -->
            <div class="p-2 flex-1 flex flex-col gap-2">
              <div class="flex-1">
                <p
                  class="text-base text-surface-600 dark:text-surface-400 whitespace-pre-wrap leading-relaxed m-0"
                >
                  {{ suggestion.description }}
                </p>
              </div>

              @if (suggestion.answer) {
                <div
                  class="p-5 bg-primary-50/50 dark:bg-primary-900/10 rounded-xl border border-primary-100 dark:border-primary-900/30 relative overflow-hidden"
                >
                  <div class="absolute top-0 left-0 w-1 h-full bg-primary-500"></div>
                  <h3
                    class="text-xs font-black uppercase tracking-widest text-primary-600 dark:text-primary-400 mb-2 flex items-center gap-2"
                  >
                    <i class="pi pi-comment text-[10px]"></i>
                    {{ 'SUGGESTIONS_FORM.ANSWER' | translate }}
                  </h3>
                  <p
                    class="text-sm text-surface-700 dark:text-surface-300 italic whitespace-pre-wrap m-0 leading-relaxed"
                  >
                    {{ suggestion.answer }}
                  </p>
                </div>
              }
            </div>

            <!-- Card Footer -->
            <div
              class="p-2 border-t "
            >
              <span
                class="text-xs font-medium text-surface-500 dark:text-surface-400 flex items-center gap-1.5"
              >
                <i class="pi pi-calendar text-[10px]"></i>
                {{ 'ACTIONS.CREATED_AT' | translate }}: {{ formatDate(suggestion.created_at) }}
              </span>

              <div
                class="flex items-center gap-1 justify-end"
              >
                <p-button
                  icon="pi pi-pencil"
                  [text]="true"
                  severity="info"
                  (click)="openEdit(suggestion)"
                  [pTooltip]="'ACTIONS.EDIT' | translate"
                  class="p-button-sm p-button-rounded"
                />
                <p-button
                  icon="pi pi-trash"
                  [text]="true"
                  severity="danger"
                  (click)="confirmDelete(suggestion)"
                  [pTooltip]="'ACTIONS.DELETE' | translate"
                  class="p-button-sm p-button-rounded"
                />
              </div>
            </div>
          </div>
        }
      </div>
    }
  }
</div>

<app-suggestion-form
  [(visible)]="isFormVisible"
  [suggestion]="selectedSuggestion()"
  (saved)="onSave($event)"
/>
