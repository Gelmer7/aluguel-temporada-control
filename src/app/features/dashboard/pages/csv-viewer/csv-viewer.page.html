<!-- Template de Ações para o Header -->
<ng-template #headerActions>
  <div class="flex items-center gap-1">
    <p-button
      icon="pi pi-upload"
      severity="secondary"
      [outlined]="true"
      size="small"
      (click)="fileInput.click()"
      pTooltip="Carregar novo relatório do Airbnb"
      tooltipPosition="left"
    />
    <input #fileInput type="file" (change)="onFileSelected($event)" accept=".csv" class="hidden" />

    <p-button
      icon="pi pi-sync"
      [severity]="syncing() ? 'warn' : 'primary'"
      size="small"
      (click)="syncDatabase()"
      [loading]="syncing()"
      [disabled]="rows().length === 0"
      pTooltip="Salvar os dados atuais no banco de dados (evita duplicatas)"
      tooltipPosition="bottom"
    />
  </div>
</ng-template>

<!-- Container principal da página -->
<p-toast />
<div class="h-full flex flex-col p-2 bg-surface-50 dark:bg-surface-950 gap-2 overflow-hidden">
  <!-- Filtros Reutilizáveis -->
  <app-filter-container>
    <!-- Resumo dos filtros (aparece quando colapsado) -->
    <ng-template #filterSummary>
      <span
        >Ano: <span class="text-primary">{{ selectedYear() || 'Todos' }}</span></span
      >
      <span
        >Mês: <span class="text-primary">{{ getSelectedMonthLabel() }}</span></span
      >
      <span
        >Tipo: <span class="text-primary">{{ selectedType() || 'Todos' }}</span></span
      >
    </ng-template>

    <!-- Conteúdo dos filtros -->
    <p-floatlabel class="flex-1 min-w-[120px]" variant="in">
      <p-select
        inputId="year_select"
        [options]="years()"
        [ngModel]="selectedYear()"
        (ngModelChange)="onYearChange($event)"
        [showClear]="true"
        class="w-full"
        appendTo="body"
      ></p-select>
      <label for="year_select">Ano</label>
    </p-floatlabel>

    <p-floatlabel class="flex-1 min-w-[120px]" variant="in">
      <p-select
        inputId="month_select"
        [options]="months"
        [ngModel]="selectedMonth()"
        (ngModelChange)="onMonthChange($event)"
        optionLabel="label"
        optionValue="value"
        [showClear]="true"
        class="w-full"
        appendTo="body"
      ></p-select>
      <label for="month_select">Mês</label>
    </p-floatlabel>

    <p-floatlabel class="flex-1 min-w-[120px]" variant="in">
      <p-select
        inputId="type_select"
        [options]="types()"
        [ngModel]="selectedType()"
        (ngModelChange)="onTypeChange($event)"
        [showClear]="true"
        class="w-full"
        appendTo="body"
      ></p-select>
      <label for="type_select">Tipo</label>
    </p-floatlabel>
  </app-filter-container>

  <!-- Resumo alinhado à direita em linha única -->
  <div class="flex-none flex justify-end">
    <div class="flex items-center gap-4 px-2 text-sm">
      <span class="text-surface-500 uppercase font-bold">Total:</span>
      <span class="font-bold text-surface-900 dark:text-surface-0">
        {{ summary().totalValor | currency: 'BRL' }}
      </span>
      <span class="text-surface-600 dark:text-surface-400">
        Limpeza: {{ summary().totalLimpeza | currency: 'BRL' }}
      </span>
      <span class="text-surface-600 dark:text-surface-400">
        Noites: {{ summary().totalNoites }}
      </span>
    </div>
  </div>

  <!-- Área da tabela com scroll -->
  <div
    class="flex-1 min-h-0 bg-surface-0 dark:bg-surface-900 rounded-xl shadow-sm border border-surface-200 dark:border-surface-700 flex flex-col overflow-hidden"
  >
    <!-- Barra de ferramentas superior (caption) -->
    <div
      class="flex items-center justify-start p-1 border-b border-surface-200 dark:border-surface-700"
    >
      <p-iconfield iconPosition="left" class="flex-1 sm:flex-none sm:w-80">
        <p-inputicon>
          <i class="pi pi-search"></i>
        </p-inputicon>
        <input
          pInputText
          type="text"
          [ngModel]="filterQuery()"
          (ngModelChange)="onFilter($event)"
          placeholder="Pesquisar..."
          class="w-full p-inputtext-sm"
        />
      </p-iconfield>

      <!-- Icon de informação -->
      <p-button
        icon="pi pi-info-circle"
        [text]="true"
        (click)="op.toggle($event)"
        class="ml-auto"
        pTooltip="Informações do Arquivo"
        tooltipPosition="left"
      />
      <p-popover #op>
        <div class="flex flex-col gap-2 p-1">
          <div
            class="flex items-center gap-2 border-b border-surface-200 dark:border-surface-700 pb-2 mb-1"
          >
            <i class="pi pi-file text-primary text-sm"></i>
            <span class="font-bold text-xs">Informações do Arquivo:</span>
          </div>

          <div class="text-sm text-surface-600 dark:text-surface-400 leading-relaxed">
            <div class="flex flex-col gap-1">
              <span class="font-semibold text-surface-900 dark:text-surface-0"
                >Última Data: {{ dateRange().last || '---' }}</span
              >
              <span class="font-semibold text-surface-900 dark:text-surface-0"
                >Primeira Data: {{ dateRange().first || '---' }}</span
              >
            </div>
            <div class="flex flex-col gap-1">
              <span class="font-semibold text-surface-900 dark:text-surface-0">Fonte:</span>
              <code
                class="bg-surface-100 dark:bg-surface-800 p-1 rounded border border-surface-200 dark:border-surface-700 break-all"
              >
                {{ rows().length > 0 ? 'Banco de Dados (airbnb_logs)' : 'Arquivo Local' }}
              </code>
            </div>
            <div class="mt-2 flex items-center gap-2">
              <span
                class="inline-block w-2 h-2 rounded-full"
                [ngClass]="rows().length > 0 ? 'bg-green-500' : 'bg-yellow-500'"
              ></span>
              <span
                >Status: {{ rows().length > 0 ? 'Sincronizado' : 'Aguardando Sincronização' }}</span
              >
            </div>
          </div>
        </div>
      </p-popover>
      <!-- Icon de configurações -->
      <p-button
        icon="pi pi-cog"
        [text]="true"
        (click)="opSettings.toggle($event)"
        pTooltip="Configurações de Visualização"
      />
      <p-popover #opSettings>
        <div class="flex flex-col gap-4 p-3 min-w-[300px]">
          <div
            class="flex items-center gap-2 border-b border-surface-200 dark:border-surface-700 pb-2"
          >
            <i class="pi pi-cog text-primary text-sm"></i>
            <span class="font-bold text-xs uppercase tracking-wider"
              >Configurações de Visualização</span
            >
          </div>

          <!-- Opção Payout -->
          <div class="flex items-center justify-between gap-4">
            <span class="text-sm font-medium text-surface-700 dark:text-surface-300"
              >Ocultar Payouts</span
            >
            <p-checkbox
              [ngModel]="hidePayout()"
              (ngModelChange)="onHidePayoutChange($event)"
              binary="true"
            ></p-checkbox>
          </div>

          <!-- Seleção de Colunas -->
          <div class="flex flex-col gap-2">
            <span class="text-sm font-medium text-surface-700 dark:text-surface-300"
              >Colunas Visíveis</span
            >
            <p-multiselect
              inputId="cols_select"
              display="chip"
              [options]="cols()"
              [ngModel]="selectedColumns()"
              (ngModelChange)="onColumnsChange($event)"
              optionLabel="headerFull"
              selectedItemsLabel="{0} colunas"
              appendTo="body"
              class="w-full"
              [maxSelectedLabels]="2"
              placeholder="Selecionar colunas"
            ></p-multiselect>
          </div>
        </div>
      </p-popover>
    </div>

    <div class="flex-1 min-h-0 w-full overflow-auto flex flex-col">
      <p-table
        #dt
        [columns]="selectedColumns()"
        [value]="pagedRows()"
        [scrollable]="true"
        scrollHeight="flex"
        [globalFilterFields]="headers()"
        [tableStyle]="{ 'min-width': '80rem' }"
        dataKey="__id"
        [rowTrackBy]="rowTrackBy"
        [loading]="loading()"
        class="p-datatable-sm h-full flex flex-col text-xs sm:text-base"
      >
        <!-- Cabeçalho das colunas (th) -->
        <ng-template pTemplate="header">
          <tr class="text-xs sm:text-base">
            @if (getColumn('Data'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Hóspede'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Tipo'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Código de Confirmação'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Pessoa Pago'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Data Inicio-Fim'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Noites'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Taxa de limpeza'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Valor'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Data de início'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Data de término'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Taxa de serviço'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Informações'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Ganhos brutos'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Pago'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }

            @if (getColumn('Anúncio'); as col) {
              <th
                [pSortableColumn]="col.field"
                [style.minWidth]="getColMinWidth(col.field)"
                [style.width]="getColMaxWidth(col.field)"
                [ngClass]="colHeaderClass(col.field)"
                class="bg-surface-50 dark:bg-surface-800"
              >
                <div class="flex items-center gap-1">
                  <span
                    class="truncate"
                    [pTooltip]="col.headerFull"
                    tooltipPosition="top"
                    showDelay="200"
                    hideDelay="0"
                    >{{ col.headerAbbr }}</span
                  >
                </div>
              </th>
            }
          </tr>
        </ng-template>

        <!-- Corpo das linhas (td) -->
        <ng-template pTemplate="body" let-row>
          <tr
            class="hover:bg-surface-50 dark:hover:bg-surface-800/50 transition-colors duration-200 text-xs sm:text-base"
          >
            <!-- Data -->
            @if (isColumnSelected('Data')) {
              <td
                [pTooltip]="colTooltip(row, 'Data')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Data')"
                [style.width]="getColMaxWidth('Data')"
                [ngClass]="tdClass(row, 'Data')"
              >
                <span class="block truncate" [style.maxWidth]="getColMaxWidth('Data')">{{
                  formatDateBR(getCellValue(row, 'Data'))
                }}</span>
              </td>
            }

            <!-- Hóspede -->
            @if (isColumnSelected('Hóspede')) {
              <td
                [pTooltip]="colTooltip(row, 'Hóspede')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Hóspede')"
                [style.width]="getColMaxWidth('Hóspede')"
                [ngClass]="tdClass(row, 'Hóspede')"
              >
                <a
                  [href]="reservationUrl(getCellValue(row, 'Código de Confirmação'))"
                  target="_blank"
                  rel="noopener noreferrer"
                  class="text-primary dark:text-primary-400 hover:underline block truncate"
                  [style.maxWidth]="getColMaxWidth('Hóspede')"
                  >{{ getCellValue(row, 'Hóspede') }}
                </a>
              </td>
            }

            <!-- Tipo -->
            @if (isColumnSelected('Tipo')) {
              <td
                [pTooltip]="colTooltip(row, 'Tipo')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Tipo')"
                [style.width]="getColMaxWidth('Tipo')"
                [ngClass]="tdClass(row, 'Tipo')"
              >
                <div
                  class="px-2 py-0.5 rounded text-xs font-medium inline-block transition-colors"
                  [class]="tdClass(row, 'Tipo')"
                >
                  {{ getCellValue(row, 'Tipo') }}
                </div>
              </td>
            }

            <!-- Código de Confirmação -->
            @if (isColumnSelected('Código de Confirmação')) {
              <td
                [pTooltip]="colTooltip(row, 'Código de Confirmação')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Código de Confirmação')"
                [style.width]="getColMaxWidth('Código de Confirmação')"
                [ngClass]="tdClass(row, 'Código de Confirmação')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Código de Confirmação')"
                  >{{ getCellValue(row, 'Código de Confirmação') }}</span
                >
              </td>
            }

            <!-- Pessoa Pago -->
            @if (isColumnSelected('Pessoa Pago')) {
              <td
                [pTooltip]="colTooltip(row, 'Pessoa Pago')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Pessoa Pago')"
                [style.width]="getColMaxWidth('Pessoa Pago')"
                [ngClass]="tdClass(row, 'Pessoa Pago')"
              >
                <div class="flex items-center gap-2">
                  <i class="pi pi-user text-xs opacity-70"></i>
                  <span class="truncate">{{ renderDerived(row, 'Pessoa Pago') }}</span>
                </div>
              </td>
            }

            <!-- Data Inicio-Fim -->
            @if (isColumnSelected('Data Inicio-Fim')) {
              <td
                [pTooltip]="colTooltip(row, 'Data Inicio-Fim')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Data Inicio-Fim')"
                [style.width]="getColMaxWidth('Data Inicio-Fim')"
                [ngClass]="tdClass(row, 'Data Inicio-Fim')"
              >
                <span class="block truncate" [style.maxWidth]="getColMaxWidth('Data Inicio-Fim')">{{
                  renderDerived(row, 'Data Inicio-Fim')
                }}</span>
              </td>
            }

            <!-- Noites -->
            @if (isColumnSelected('Noites')) {
              <td
                [pTooltip]="colTooltip(row, 'Noites')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Noites')"
                [style.width]="getColMaxWidth('Noites')"
                [ngClass]="tdClass(row, 'Noites')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Noites')"
                  >{{ getCellValue(row, 'Noites') }}</span
                >
              </td>
            }

            <!-- Taxa de limpeza -->
            @if (isColumnSelected('Taxa de limpeza')) {
              <td
                [pTooltip]="colTooltip(row, 'Taxa de limpeza')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Taxa de limpeza')"
                [style.width]="getColMaxWidth('Taxa de limpeza')"
                [ngClass]="tdClass(row, 'Taxa de limpeza')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Taxa de limpeza')"
                  >{{ getCellValue(row, 'Taxa de limpeza') }}</span
                >
              </td>
            }

            <!-- Valor -->
            @if (isColumnSelected('Valor')) {
              <td
                [pTooltip]="colTooltip(row, 'Valor')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Valor')"
                [style.width]="getColMaxWidth('Valor')"
                [ngClass]="tdClass(row, 'Valor')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Valor')"
                  >{{ getCellValue(row, 'Valor') }}</span
                >
              </td>
            }

            <!-- Data de início -->
            @if (isColumnSelected('Data de início')) {
              <td
                [pTooltip]="colTooltip(row, 'Data de início')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Data de início')"
                [style.width]="getColMaxWidth('Data de início')"
                [ngClass]="tdClass(row, 'Data de início')"
              >
                <span class="block truncate" [style.maxWidth]="getColMaxWidth('Data de início')">{{
                  formatDateBR(getCellValue(row, 'Data de início'))
                }}</span>
              </td>
            }

            <!-- Data de término -->
            @if (isColumnSelected('Data de término')) {
              <td
                [pTooltip]="colTooltip(row, 'Data de término')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Data de término')"
                [style.width]="getColMaxWidth('Data de término')"
                [ngClass]="tdClass(row, 'Data de término')"
              >
                <span class="block truncate" [style.maxWidth]="getColMaxWidth('Data de término')">{{
                  formatDateBR(getCellValue(row, 'Data de término'))
                }}</span>
              </td>
            }

            <!-- Taxa de serviço -->
            @if (isColumnSelected('Taxa de serviço')) {
              <td
                [pTooltip]="colTooltip(row, 'Taxa de serviço')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Taxa de serviço')"
                [style.width]="getColMaxWidth('Taxa de serviço')"
                [ngClass]="tdClass(row, 'Taxa de serviço')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Taxa de serviço')"
                  >{{ getCellValue(row, 'Taxa de serviço') }}</span
                >
              </td>
            }

            <!-- Informações -->
            @if (isColumnSelected('Informações')) {
              <td
                [pTooltip]="colTooltip(row, 'Informações')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Informações')"
                [style.width]="getColMaxWidth('Informações')"
                [ngClass]="tdClass(row, 'Informações')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Informações')"
                  >{{ getCellValue(row, 'Informações') }}</span
                >
              </td>
            }

            <!-- Ganhos brutos -->
            @if (isColumnSelected('Ganhos brutos')) {
              <td
                [pTooltip]="colTooltip(row, 'Ganhos brutos')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Ganhos brutos')"
                [style.width]="getColMaxWidth('Ganhos brutos')"
                [ngClass]="tdClass(row, 'Ganhos brutos')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Ganhos brutos')"
                  >{{ getCellValue(row, 'Ganhos brutos') }}</span
                >
              </td>
            }

            <!-- Pago -->
            @if (isColumnSelected('Pago')) {
              <td
                [pTooltip]="colTooltip(row, 'Pago')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Pago')"
                [style.width]="getColMaxWidth('Pago')"
                [ngClass]="tdClass(row, 'Pago')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Pago')"
                  >{{ getCellValue(row, 'Pago') }}</span
                >
              </td>
            }

            <!-- Anúncio -->
            @if (isColumnSelected('Anúncio')) {
              <td
                [pTooltip]="colTooltip(row, 'Anúncio')"
                tooltipPosition="top"
                [showDelay]="200"
                [hideDelay]="0"
                [style.minWidth]="getColMinWidth('Anúncio')"
                [style.width]="getColMaxWidth('Anúncio')"
                [ngClass]="tdClass(row, 'Anúncio')"
              >
                <span
                  class="block truncate font-medium"
                  [style.maxWidth]="getColMaxWidth('Anúncio')"
                  >{{ getCellValue(row, 'Anúncio') }}</span
                >
              </td>
            }
          </tr>
        </ng-template>
      </p-table>
    </div>

    <!-- Paginador Reutilizável -->
    <app-table-paginator
      [first]="first()"
      [rows]="rowsPerPage()"
      [totalRecords]="visibleRows().length"
      [rowsPerPageOptions]="[10, 20, 50, 100]"
      (onPageChange)="onPageChange($event)"
    />
  </div>
</div>
